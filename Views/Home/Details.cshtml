@model NhomProject.Models.ViewModel.ProductDetailVM

@{
    ViewData["Title"] = Model.Product.Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <!-- LEFT COLUMN: Image and Tabs -->
        <div class="col-lg-8">

            <!-- Main Product Image -->
            <div class="card product-card-main-image mb-3">
                <div style="height: 500px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                    <img src="@(string.IsNullOrEmpty(Model.Product.MainImageUrl) ? "https://placehold.co/750x500/f0f0f0/999?text=No+Image" : Url.Content(Model.Product.MainImageUrl))"
                         alt="@Model.Product.Name"
                         style="max-height: 100%; max-width: 100%; object-fit: contain;" />
                </div>
            </div>

            <!-- Product Tabs -->
            <div class="card product-tabs-container">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="productTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs" type="button">Thông số kỹ thuật</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button">Thông tin sản phẩm</button>
                        </li>
                    </ul>
                </div>
                <div class="card-body tab-content" id="productTabContent">
                    <div class="tab-pane fade show active" id="specs" role="tabpanel">
                        <h4 class="tab-title">Thông số kỹ thuật</h4>
                        <div class="product-info-description">
                            @Html.Raw(Model.Product.Description)
                        </div>
                    </div>
                    <div class="tab-pane fade" id="description" role="tabpanel">
                        <h4 class="tab-title">Mô tả sản phẩm</h4>
                        <p>@Model.Product.Name là sản phẩm chính hãng...</p>
                    </div>
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN: Info and Actions -->
        <div class="col-lg-4 product-sidebar">
            <div class="sidebar-box">
                <h1 class="product-info-title">@Model.Product.Name</h1>
                <div class="product-info-rating">
                    @Model.Product.Rating Stars (@Model.Product.ReviewCount reviews)
                </div>
            </div>

            <div class="sidebar-box card">
                <div class="card-body">
                    <div class="product-info-price">
                        @Model.Product.Price.ToString("C")
                        @if (Model.Product.OldPrice.HasValue && Model.Product.OldPrice.Value > Model.Product.Price)
                        {
                            <span class="product-info-price-old">
                                @Model.Product.OldPrice.Value.ToString("C")
                            </span>
                        }
                    </div>
                    <div class="product-promotions mt-3">
                        <strong>Ưu đãi:</strong>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check-circle text-success"></i> Giảm giá khi thanh toán online.</li>
                            <li><i class="fas fa-check-circle text-success"></i> Miễn phí vận chuyển.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="sidebar-box card">
                <div class="card-body">
                    @using (Html.BeginForm("AddToCart", "Home", new { id = Model.Product.ProductId }, FormMethod.Post))
                    {
                        <div class="product-info-actions">
                            <label for="quantity" class="form-label">Số Lượng:</label>
                            <input type="number" id="quantity" name="quantity" value="1" min="1" class="form-control mb-3" />

                            <button type="submit" class="btn btn-outline-primary btn-lg w-100 mb-2">
                                <i class="fas fa-cart-plus"></i> Thêm vào Giỏ Hàng
                            </button>
                        </div>
                    }
                    <a href="@Url.Action("Checkout", "Home")" class="btn btn-danger btn-lg w-100">
                        Mua ngay
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- --- NEW SECTIONS START HERE --- -->
    <!-- Related Products -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="section-title border-bottom pb-2 mb-4">Sản phẩm tương tự</h3>
        </div>
        @foreach (var item in Model.RelatedProducts)
        {
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card h-100 product-card">
                    <div class="product-card-image" style="height: 200px; display: flex; align-items: center; justify-content: center; padding: 10px;">
                        <img src="@(string.IsNullOrEmpty(item.ThumbnailUrl) ? (string.IsNullOrEmpty(item.MainImageUrl) ? "https://placehold.co/200x200?text=No+Image" : Url.Content(item.MainImageUrl)) : Url.Content(item.ThumbnailUrl))"
                             alt="@item.Name" style="max-height: 100%; max-width: 100%; object-fit: contain;">
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" style="font-size: 1rem; height: 40px; overflow: hidden;">
                            <a href="@Url.Action("Details", "Home", new { id = item.ProductId })" class="text-decoration-none text-dark">@item.Name</a>
                        </h5>
                        <p class="card-text text-danger fw-bold">@item.Price.ToString("C")</p>
                        <a href="@Url.Action("Details", "Home", new { id = item.ProductId })" class="btn btn-primary mt-auto">Xem chi tiết</a>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Top Products -->
    <div class="row mt-4 mb-5">
        <div class="col-12">
            <h3 class="section-title border-bottom pb-2 mb-4">Sản phẩm bán chạy</h3>
        </div>
        @foreach (var item in Model.TopProducts)
        {
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card h-100 product-card">
                    <div class="product-card-image" style="height: 200px; display: flex; align-items: center; justify-content: center; padding: 10px;">
                        <img src="@(string.IsNullOrEmpty(item.ThumbnailUrl) ? (string.IsNullOrEmpty(item.MainImageUrl) ? "https://placehold.co/200x200?text=No+Image" : Url.Content(item.MainImageUrl)) : Url.Content(item.ThumbnailUrl))"
                             alt="@item.Name" style="max-height: 100%; max-width: 100%; object-fit: contain;">
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" style="font-size: 1rem; height: 40px; overflow: hidden;">
                            <a href="@Url.Action("Details", "Home", new { id = item.ProductId })" class="text-decoration-none text-dark">@item.Name</a>
                        </h5>
                        <p class="card-text text-danger fw-bold">@item.Price.ToString("C")</p>
                        <a href="@Url.Action("Details", "Home", new { id = item.ProductId })" class="btn btn-primary mt-auto">Xem chi tiết</a>
                    </div>
                </div>
            </div>
        }
    </div>

</div>