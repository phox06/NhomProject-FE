@model NhomProject.Models.Product
@using System.Globalization

@{
    // 1. Setup Currency Format
    var viCulture = new CultureInfo("vi-VN");
    viCulture.NumberFormat.NumberDecimalDigits = 0;
    viCulture.NumberFormat.NumberGroupSeparator = ".";

    // 2. Check if we should show Buy Buttons (Passed from Parent View)
    bool showBuyButtons = ViewData["ShowBuyButtons"] != null && (bool)ViewData["ShowBuyButtons"];
}

<style>
    /* Copied CSS from your Details Home so Admin page looks good too */
    .product-gallery-thumbs {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        overflow-x: auto;
    }

    .thumb-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border: 1px solid #ddd;
        cursor: pointer;
        border-radius: 5px;
    }

        .thumb-img:hover {
            border-color: #d00;
        }

    .main-img-container {
        border: 1px solid #f0f0f0;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .main-img-container img {
            max-height: 100%;
            max-width: 100%;
        }

    .price-box {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .current-price {
        font-size: 28px;
        color: #d0021b;
        font-weight: bold;
    }

    .old-price {
        text-decoration: line-through;
        color: #666;
        margin-left: 10px;
    }

    .btn-buy-now {
        background: #d0021b;
        color: white;
        font-weight: bold;
        width: 100%;
        padding: 15px;
        text-transform: uppercase;
        border: none;
        border-radius: 5px;
    }

        .btn-buy-now:hover {
            background: #a80014;
            color: white;
        }

    .btn-add-cart {
        background: #fff;
        color: #d0021b;
        border: 2px solid #d0021b;
        font-weight: bold;
        width: 100%;
        padding: 15px;
        text-transform: uppercase;
        border-radius: 5px;
        transition: all 0.3s;
    }

        .btn-add-cart:hover {
            background: #fceceb;
            color: #d0021b;
        }

    .action-buttons {
        display: flex;
        gap: 10px;
    }
</style>

<div class="row">
    <div class="col-md-5">
        <div class="main-img-container">
            <img id="mainImage"
                 src="@(string.IsNullOrEmpty(Model.MainImageUrl) ? "https://placehold.co/500x500?text=No+Image" : Url.Content(Model.MainImageUrl))"
                 alt="@Model.Name" />
        </div>

        <div class="product-gallery-thumbs">
            <img src="@(string.IsNullOrEmpty(Model.MainImageUrl) ? "https://placehold.co/100x100" : Url.Content(Model.MainImageUrl))"
                 class="thumb-img" onclick="changeImage(this.src)" />

            @if (Model.ProductImages != null)
            {
                foreach (var img in Model.ProductImages)
                {
                    <img src="@Url.Content(img.ImageUrl)" class="thumb-img" onclick="changeImage(this.src)" />
                }
            }
        </div>
    </div>

    <div class="col-md-7">
        <h1 style="font-size: 24px; font-weight: 700;">@Model.Name</h1>

        <div class="d-flex align-items-center mb-3">
            <div class="text-warning mr-2">
                @for (int i = 1; i <= 5; i++)
                {
                    if (i <= Model.Rating)
                    {<i class="fas fa-star"></i> }
                    else
                    { <i class="far fa-star"></i>}
                }
            </div>
            <span class="text-muted">(@Model.ReviewCount đánh giá)</span>
        </div>

        <div class="price-box">
            <span class="current-price">@Model.Price.ToString("N0", viCulture)Đ</span>
            @if (Model.OldPrice > Model.Price)
            {
                <span class="old-price">@Model.OldPrice.Value.ToString("N0", viCulture)Đ</span>
            }
        </div>

        <ul class="mb-4 list-unstyled">
            <li><i class="fas fa-check text-success"></i> Hàng chính hãng, bảo hành 12 tháng</li>
            <li><i class="fas fa-check text-success"></i> Giao hàng toàn quốc</li>
        </ul>

        @if (showBuyButtons)
        {
            using (Html.BeginForm("AddToCart", "Home", FormMethod.Post))
            {
                <input type="hidden" name="productId" value="@Model.ProductId" />
                <div class="d-flex align-items-center mb-3">
                    <label class="me-3 fw-bold">Số lượng:</label>
                    <input type="number" name="quantity" value="1" min="1" max="10" class="form-control" style="width: 80px;" />
                </div>
                <div class="action-buttons">
                    <button type="submit" name="redirectType" value="stay" class="btn-add-cart">
                        <i class="fas fa-cart-plus"></i> Thêm vào giỏ
                    </button>
                    <button type="submit" name="redirectType" value="buynow" class="btn-buy-now">
                        <i class="fas fa-check"></i> Mua Ngay
                    </button>
                </div>
            }
        }
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="desc-tab" data-bs-toggle="tab" data-bs-target="#desc" type="button">Mô tả sản phẩm</button>
                </li>
            </ul>

            <div class="tab-content p-4 border border-top-0 bg-white" id="myTabContent">
                <div class="tab-pane fade show active" id="desc">
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        @Html.Raw(Model.Description)
                    }
                    else
                    {
                        <p class="text-muted">Đang cập nhật mô tả...</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function changeImage(src) {
        document.getElementById('mainImage').src = src;
    }
</script>
